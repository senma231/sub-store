# Sub-Store æ‰‹åŠ¨éƒ¨ç½²è¯¦ç»†æ•™ç¨‹

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨é€šè¿‡ GitHub å’Œ Cloudflare æ‰‹åŠ¨éƒ¨ç½² Sub-Store ç³»ç»Ÿã€‚

**éƒ¨ç½²æ¶æ„**ï¼š
- å‰ç«¯ï¼šGitHub Pagesï¼ˆå…è´¹ï¼‰
- åç«¯ï¼šCloudflare Workersï¼ˆå…è´¹ï¼‰
- å­˜å‚¨ï¼šCloudflare KVï¼ˆå…è´¹ï¼‰
- è‡ªåŠ¨åŒ–ï¼šGitHub Actionsï¼ˆå…è´¹ï¼‰

**é¢„è®¡æ—¶é—´**ï¼š30-45 åˆ†é’Ÿ

---

## ğŸ”§ ç¬¬ä¸€éƒ¨åˆ†ï¼šCloudflare é…ç½®

### æ­¥éª¤ 1ï¼šæ³¨å†Œ Cloudflare è´¦æˆ·

1. **è®¿é—® Cloudflare å®˜ç½‘**
   - æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://cloudflare.com
   - ç‚¹å‡»å³ä¸Šè§’ "Sign Up" æŒ‰é’®

2. **å¡«å†™æ³¨å†Œä¿¡æ¯**
   - è¾“å…¥é‚®ç®±åœ°å€
   - è®¾ç½®å¯†ç ï¼ˆå»ºè®®ä½¿ç”¨å¼ºå¯†ç ï¼‰
   - ç‚¹å‡» "Create Account"

3. **éªŒè¯é‚®ç®±**
   - æ£€æŸ¥é‚®ç®±æ”¶ä»¶ç®±
   - ç‚¹å‡»éªŒè¯é“¾æ¥å®Œæˆæ³¨å†Œ

### æ­¥éª¤ 2ï¼šè·å– Cloudflare Account ID

1. **ç™»å½• Cloudflare Dashboard**
   - è®¿é—®ï¼šhttps://dash.cloudflare.com
   - ä½¿ç”¨åˆšæ³¨å†Œçš„è´¦æˆ·ç™»å½•

2. **æŸ¥æ‰¾ Account ID**
   - ç™»å½•åï¼Œåœ¨å³ä¾§è¾¹æ æ‰¾åˆ° "Account ID"
   - å¤åˆ¶è¿™ä¸ª IDï¼ˆæ ¼å¼ç±»ä¼¼ï¼š1234567890abcdef1234567890abcdefï¼‰
   - **é‡è¦**ï¼šå°†æ­¤ ID ä¿å­˜åˆ°è®°äº‹æœ¬ï¼Œç¨åéœ€è¦ä½¿ç”¨

### æ­¥éª¤ 3ï¼šåˆ›å»º API Token

1. **è¿›å…¥ API Token é¡µé¢**
   - ç‚¹å‡»å³ä¸Šè§’å¤´åƒ
   - é€‰æ‹© "My Profile"
   - ç‚¹å‡» "API Tokens" æ ‡ç­¾

2. **åˆ›å»ºè‡ªå®šä¹‰ Token**
   - ç‚¹å‡» "Create Token" æŒ‰é’®
   - é€‰æ‹© "Custom token" æ¨¡æ¿

3. **é…ç½® Token æƒé™**
   ```
   Token name: Sub-Store-Deploy
   
   Permissions:
   - Account | Cloudflare Workers:Edit
   - Zone | Zone:Read (å¯é€‰ï¼Œä»…åœ¨ä½¿ç”¨è‡ªå®šä¹‰åŸŸåæ—¶éœ€è¦)
   
   Account Resources:
   - Include | All accounts
   
   Zone Resources:
   - Include | All zones (å¦‚æœæ·»åŠ äº† Zone æƒé™)
   ```

4. **ç”Ÿæˆå¹¶ä¿å­˜ Token**
   - ç‚¹å‡» "Continue to summary"
   - ç‚¹å‡» "Create Token"
   - **é‡è¦**ï¼šå¤åˆ¶ç”Ÿæˆçš„ Token å¹¶ä¿å­˜åˆ°è®°äº‹æœ¬
   - è¿™ä¸ª Token åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œè¯·åŠ¡å¿…ä¿å­˜

### æ­¥éª¤ 4ï¼šå®‰è£… Wrangler CLI

1. **å®‰è£… Node.js**ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
   - è®¿é—®ï¼šhttps://nodejs.org
   - ä¸‹è½½å¹¶å®‰è£… LTS ç‰ˆæœ¬

2. **å®‰è£… Wrangler**
   - æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼ˆWindows: CMD æˆ– PowerShellï¼ŒMac: Terminalï¼‰
   - è¿è¡Œå‘½ä»¤ï¼š
   ```bash
   npm install -g wrangler
   ```

3. **éªŒè¯å®‰è£…**
   ```bash
   wrangler --version
   ```

### æ­¥éª¤ 5ï¼šç™»å½• Cloudflare

1. **ä½¿ç”¨ Wrangler ç™»å½•**
   ```bash
   wrangler auth login
   ```

2. **æµè§ˆå™¨æˆæƒ**
   - å‘½ä»¤ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
   - ç‚¹å‡» "Authorize Wrangler" æŒ‰é’®
   - è¿”å›å‘½ä»¤è¡Œï¼Œåº”è¯¥æ˜¾ç¤ºç™»å½•æˆåŠŸ

### æ­¥éª¤ 6ï¼šåˆ›å»º KV å‘½åç©ºé—´

1. **åˆ›å»ºç”Ÿäº§ç¯å¢ƒ KV**
   ```bash
   wrangler kv:namespace create "SUB_STORE_KV"
   ```
   - è®°å½•è¿”å›çš„ `id`ï¼ˆç±»ä¼¼ï¼šabcdef1234567890abcdef1234567890ï¼‰

2. **åˆ›å»ºé¢„è§ˆç¯å¢ƒ KV**
   ```bash
   wrangler kv:namespace create "SUB_STORE_KV" --preview
   ```
   - è®°å½•è¿”å›çš„ `preview_id`

3. **ä¿å­˜ KV ID**
   - å°†ä¸¤ä¸ª ID ä¿å­˜åˆ°è®°äº‹æœ¬ï¼š
   ```
   ç”Ÿäº§ç¯å¢ƒ KV ID: abcdef1234567890abcdef1234567890
   é¢„è§ˆç¯å¢ƒ KV ID: fedcba0987654321fedcba0987654321
   ```

---

## ğŸ™ ç¬¬äºŒéƒ¨åˆ†ï¼šGitHub é…ç½®

### æ­¥éª¤ 7ï¼šFork é¡¹ç›®

1. **è®¿é—®é¡¹ç›®ä»“åº“**
   - æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼šhttps://github.com/senma231/sub-store

2. **Fork ä»“åº“**
   - ç‚¹å‡»å³ä¸Šè§’ "Fork" æŒ‰é’®
   - ç¡®è®¤ Fork åˆ°æ‚¨çš„è´¦æˆ·
   - ç­‰å¾… Fork å®Œæˆ

### æ­¥éª¤ 8ï¼šé…ç½® GitHub Secrets

1. **è¿›å…¥ Secrets è®¾ç½®é¡µé¢**
   - åœ¨æ‚¨ Fork çš„ä»“åº“é¡µé¢
   - ç‚¹å‡» "Settings" æ ‡ç­¾
   - åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» "Secrets and variables"
   - é€‰æ‹© "Actions"

2. **æ·»åŠ ç¬¬ä¸€ä¸ª Secretï¼šCLOUDFLARE_API_TOKEN**
   - ç‚¹å‡» "New repository secret" æŒ‰é’®
   - Name: `CLOUDFLARE_API_TOKEN`
   - Secret: ç²˜è´´ä¹‹å‰ä¿å­˜çš„ API Token
   - ç‚¹å‡» "Add secret"

3. **æ·»åŠ ç¬¬äºŒä¸ª Secretï¼šCLOUDFLARE_ACCOUNT_ID**
   - ç‚¹å‡» "New repository secret" æŒ‰é’®
   - Name: `CLOUDFLARE_ACCOUNT_ID`
   - Secret: ç²˜è´´ä¹‹å‰ä¿å­˜çš„ Account ID
   - ç‚¹å‡» "Add secret"

4. **æ·»åŠ ç¬¬ä¸‰ä¸ª Secretï¼šAPI_BASE_URL**
   - ç‚¹å‡» "New repository secret" æŒ‰é’®
   - Name: `API_BASE_URL`
   - Secret: `https://sub-store-api.æ‚¨çš„GitHubç”¨æˆ·å.workers.dev`
   - ä¾‹å¦‚ï¼š`https://sub-store-api.senma231.workers.dev`
   - ç‚¹å‡» "Add secret"

5. **æ·»åŠ ç¬¬å››ä¸ª Secretï¼šFRONTEND_URL**
   - ç‚¹å‡» "New repository secret" æŒ‰é’®
   - Name: `FRONTEND_URL`
   - Secret: `https://æ‚¨çš„GitHubç”¨æˆ·å.github.io/sub-store`
   - ä¾‹å¦‚ï¼š`https://senma231.github.io/sub-store`
   - ç‚¹å‡» "Add secret"

### æ­¥éª¤ 9ï¼šå¯ç”¨ GitHub Pages

1. **è¿›å…¥ Pages è®¾ç½®**
   - åœ¨ä»“åº“é¡µé¢ç‚¹å‡» "Settings" æ ‡ç­¾
   - åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° "Pages"

2. **é…ç½® Pages**
   - Source: é€‰æ‹© "GitHub Actions"
   - ç‚¹å‡» "Save" ä¿å­˜è®¾ç½®

---

## âš™ï¸ ç¬¬ä¸‰éƒ¨åˆ†ï¼šé…ç½®é¡¹ç›®æ–‡ä»¶

### æ­¥éª¤ 10ï¼šä¸‹è½½å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶

1. **å…‹éš†ä»“åº“åˆ°æœ¬åœ°**
   ```bash
   git clone https://github.com/æ‚¨çš„ç”¨æˆ·å/sub-store.git
   cd sub-store
   ```

2. **ä¿®æ”¹ wrangler.toml æ–‡ä»¶**
   - æ‰“å¼€ `workers/wrangler.toml` æ–‡ä»¶
   - æ‰¾åˆ°ä»¥ä¸‹éƒ¨åˆ†å¹¶ä¿®æ”¹ï¼š
   ```toml
   [[kv_namespaces]]
   binding = "SUB_STORE_KV"
   id = "æ‚¨çš„ç”Ÿäº§ç¯å¢ƒKV_ID"
   preview_id = "æ‚¨çš„é¢„è§ˆç¯å¢ƒKV_ID"
   
   [vars]
   CORS_ORIGINS = "https://æ‚¨çš„ç”¨æˆ·å.github.io,https://your-domain.com"
   ```

3. **ä¿å­˜æ–‡ä»¶**

### æ­¥éª¤ 11ï¼šè®¾ç½® Workers Secrets

1. **è¿›å…¥ workers ç›®å½•**
   ```bash
   cd workers
   ```

2. **ç”Ÿæˆç®¡ç†å‘˜å¯†ç **
   - Windows PowerShell:
   ```powershell
   -join ((1..32) | ForEach {'{0:X}' -f (Get-Random -Max 16)})
   ```
   - Mac/Linux:
   ```bash
   openssl rand -hex 32
   ```
   - ä¿å­˜ç”Ÿæˆçš„å¯†ç ï¼ˆè¿™æ˜¯æ‚¨çš„ç®¡ç†å‘˜ç™»å½•å¯†ç ï¼‰

3. **ç”Ÿæˆ JWT å¯†é’¥**
   - Windows PowerShell:
   ```powershell
   -join ((1..64) | ForEach {'{0:X}' -f (Get-Random -Max 16)})
   ```
   - Mac/Linux:
   ```bash
   openssl rand -hex 64
   ```
   - ä¿å­˜ç”Ÿæˆçš„å¯†é’¥

4. **è®¾ç½® Workers Secrets**
   ```bash
   # è®¾ç½®ç®¡ç†å‘˜å¯†ç 
   wrangler secret put ADMIN_TOKEN
   # è¾“å…¥åˆšæ‰ç”Ÿæˆçš„ç®¡ç†å‘˜å¯†ç 

   # è®¾ç½® JWT å¯†é’¥
   wrangler secret put JWT_SECRET
   # è¾“å…¥åˆšæ‰ç”Ÿæˆçš„ JWT å¯†é’¥
   ```

### æ­¥éª¤ 12ï¼šéƒ¨ç½² Workers

1. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

2. **éƒ¨ç½²åˆ° Cloudflare**
   ```bash
   npm run deploy
   ```

3. **éªŒè¯éƒ¨ç½²**
   - è®¿é—®ï¼š`https://sub-store-api.æ‚¨çš„ç”¨æˆ·å.workers.dev/health`
   - åº”è¯¥çœ‹åˆ°å¥åº·æ£€æŸ¥å“åº”

---

## ğŸš€ ç¬¬å››éƒ¨åˆ†ï¼šè§¦å‘å‰ç«¯éƒ¨ç½²

### æ­¥éª¤ 13ï¼šæ¨é€ä»£ç è§¦å‘éƒ¨ç½²

1. **æäº¤ä¿®æ”¹**
   ```bash
   cd ..  # å›åˆ°é¡¹ç›®æ ¹ç›®å½•
   git add .
   git commit -m "Configure for production deployment"
   ```

2. **æ¨é€åˆ° GitHub**
   ```bash
   git push origin master
   ```

3. **æŸ¥çœ‹ Actions æ‰§è¡Œ**
   - åœ¨ GitHub ä»“åº“é¡µé¢ç‚¹å‡» "Actions" æ ‡ç­¾
   - æŸ¥çœ‹éƒ¨ç½²è¿›åº¦
   - ç­‰å¾…æ‰€æœ‰æ­¥éª¤å®Œæˆï¼ˆé€šå¸¸éœ€è¦ 5-10 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 14ï¼šéªŒè¯éƒ¨ç½²ç»“æœ

1. **æ£€æŸ¥å‰ç«¯**
   - è®¿é—®ï¼š`https://æ‚¨çš„ç”¨æˆ·å.github.io/sub-store`
   - åº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢

2. **æ£€æŸ¥åç«¯ API**
   - è®¿é—®ï¼š`https://sub-store-api.æ‚¨çš„ç”¨æˆ·å.workers.dev/health`
   - åº”è¯¥è¿”å›å¥åº·çŠ¶æ€

3. **æµ‹è¯•ç™»å½•**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼šä¹‹å‰ç”Ÿæˆçš„ç®¡ç†å‘˜å¯†ç 

---

## ğŸ” ç¬¬äº”éƒ¨åˆ†ï¼šæ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜ 1ï¼šWorkers éƒ¨ç½²å¤±è´¥
**ç—‡çŠ¶**ï¼š`wrangler deploy` å‘½ä»¤æŠ¥é”™

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `wrangler.toml` é…ç½®æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ KV ID æ˜¯å¦æ­£ç¡®å¡«å†™
3. é‡æ–°ç™»å½•ï¼š`wrangler auth login`

#### é—®é¢˜ 2ï¼šGitHub Actions å¤±è´¥
**ç—‡çŠ¶**ï¼šActions é¡µé¢æ˜¾ç¤ºçº¢è‰²é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ GitHub Secrets æ˜¯å¦æ­£ç¡®è®¾ç½®
2. ç¡®è®¤ API Token æƒé™æ˜¯å¦è¶³å¤Ÿ
3. æŸ¥çœ‹ Actions æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### é—®é¢˜ 3ï¼šå‰ç«¯æ— æ³•è®¿é—®
**ç—‡çŠ¶**ï¼šGitHub Pages åœ°å€è¿”å› 404

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ GitHub Pages å·²å¯ç”¨
2. ç­‰å¾… Actions éƒ¨ç½²å®Œæˆ
3. æ£€æŸ¥ Pages è®¾ç½®ä¸­çš„ Source æ˜¯å¦ä¸º "GitHub Actions"

#### é—®é¢˜ 4ï¼šAPI æ— æ³•è®¿é—®
**ç—‡çŠ¶**ï¼šAPI åœ°å€è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Workers æ˜¯å¦éƒ¨ç½²æˆåŠŸ
2. ç¡®è®¤ KV å‘½åç©ºé—´æ˜¯å¦åˆ›å»º
3. æ£€æŸ¥ Workers Secrets æ˜¯å¦è®¾ç½®

#### é—®é¢˜ 5ï¼šç™»å½•å¤±è´¥
**ç—‡çŠ¶**ï¼šè¾“å…¥ç”¨æˆ·åå¯†ç åæç¤ºé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„ç®¡ç†å‘˜å¯†ç 
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. ç¡®è®¤ API åœ°å€å¯ä»¥æ­£å¸¸è®¿é—®

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

### æœ€ç»ˆéªŒè¯æ­¥éª¤

- [ ] Cloudflare Account ID å·²è·å–å¹¶ä¿å­˜
- [ ] Cloudflare API Token å·²åˆ›å»ºå¹¶ä¿å­˜
- [ ] KV å‘½åç©ºé—´å·²åˆ›å»ºï¼ˆç”Ÿäº§å’Œé¢„è§ˆç¯å¢ƒï¼‰
- [ ] GitHub ä»“åº“å·² Fork
- [ ] GitHub Secrets å·²å…¨éƒ¨è®¾ç½®ï¼ˆ4ä¸ªï¼‰
- [ ] GitHub Pages å·²å¯ç”¨
- [ ] wrangler.toml å·²æ­£ç¡®é…ç½®
- [ ] Workers Secrets å·²è®¾ç½®ï¼ˆADMIN_TOKEN å’Œ JWT_SECRETï¼‰
- [ ] Workers å·²æˆåŠŸéƒ¨ç½²
- [ ] GitHub Actions å·²æˆåŠŸæ‰§è¡Œ
- [ ] å‰ç«¯é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] åç«¯ API å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ç®¡ç†å‘˜ç™»å½•åŠŸèƒ½æ­£å¸¸

### è®¿é—®åœ°å€ç¡®è®¤

- **å‰ç«¯ç®¡ç†ç•Œé¢**ï¼š`https://æ‚¨çš„ç”¨æˆ·å.github.io/sub-store`
- **åç«¯ API**ï¼š`https://sub-store-api.æ‚¨çš„ç”¨æˆ·å.workers.dev`
- **å¥åº·æ£€æŸ¥**ï¼š`https://sub-store-api.æ‚¨çš„ç”¨æˆ·å.workers.dev/health`

### ç™»å½•ä¿¡æ¯

- **ç”¨æˆ·å**ï¼š`admin`
- **å¯†ç **ï¼šæ‚¨ç”Ÿæˆçš„ ADMIN_TOKEN

---

## ğŸ‰ æ­å–œï¼

æ‚¨å·²æˆåŠŸéƒ¨ç½²äº† Sub-Store ä»£ç†èŠ‚ç‚¹è®¢é˜…ç®¡ç†ç³»ç»Ÿï¼

ç°åœ¨æ‚¨å¯ä»¥ï¼š
- ğŸ”§ æ·»åŠ å’Œç®¡ç†ä»£ç†èŠ‚ç‚¹
- ğŸ”— ç”Ÿæˆå„ç§æ ¼å¼çš„è®¢é˜…é“¾æ¥
- ğŸ“Š æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ
- âš™ï¸ é…ç½®ç³»ç»Ÿè®¾ç½®

**é‡è¦æé†’**ï¼š
- è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ç®¡ç†å‘˜å¯†ç å’Œ API Token
- å®šæœŸå¤‡ä»½é‡è¦çš„èŠ‚ç‚¹é…ç½®
- å…³æ³¨é¡¹ç›®æ›´æ–°ä»¥è·å–æ–°åŠŸèƒ½å’Œå®‰å…¨ä¿®å¤

äº«å—æ‚¨çš„ä»£ç†è®¢é˜…ç®¡ç†ç³»ç»Ÿå§ï¼
