<!DOCTYPE html>
<html>
<head>
    <title>ä¿®å¤åçš„ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .info { background-color: #d1ecf1; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #007bff; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¿®å¤åçš„Sub-Storeç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ” 1. ç™»å½•åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•ç™»å½•æ˜¯å¦æ¢å¤æ­£å¸¸ï¼Œä¸å†è¢«åçˆ¬æœºåˆ¶å½±å“</p>
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
        <div id="login-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š 2. ç®¡ç†åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•èŠ‚ç‚¹ç®¡ç†ã€è®¢é˜…ç®¡ç†ç­‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸</p>
        <button onclick="testManagementAPI()">æµ‹è¯•ç®¡ç†API</button>
        <div id="management-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ›¡ï¸ 3. ç²¾å‡†åçˆ¬æœºåˆ¶æµ‹è¯•</h2>
        <p>æµ‹è¯•æ–°çš„è®¢é˜…ä¸“ç”¨åçˆ¬æœºåˆ¶</p>
        <button onclick="testAntiCrawler()">æµ‹è¯•åçˆ¬æœºåˆ¶</button>
        <div id="anticrawler-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”’ 4. èŠ‚ç‚¹åŠ å¯†æµ‹è¯•</h2>
        <p>æµ‹è¯•æ–°çš„èŠ‚ç‚¹åŠ å¯†ä¿æŠ¤æœºåˆ¶</p>
        <button onclick="testNodeEncryption()">æµ‹è¯•èŠ‚ç‚¹åŠ å¯†</button>
        <div id="encryption-results"></div>
    </div>

    <script>
        function addResult(containerId, title, content, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<h4>${title}</h4><pre>${content}</pre>`;
            container.appendChild(div);
        }

        async function testLogin() {
            const container = 'login-results';
            document.getElementById(container).innerHTML = '';
            
            try {
                addResult(container, 'ğŸš€ æµ‹è¯•ç™»å½•åŠŸèƒ½', 'æ­£åœ¨æµ‹è¯•...', 'info');
                
                const response = await fetch('https://sub-api.senma.io/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'Sz@2400104'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success && data.data && data.data.token && data.data.token !== '[REDACTED]') {
                    addResult(container, 'âœ… ç™»å½•åŠŸèƒ½æ­£å¸¸', 
                        `çŠ¶æ€ç : ${response.status}\n` +
                        `æˆåŠŸ: ${data.success}\n` +
                        `Tokenå­˜åœ¨: æ˜¯\n` +
                        `Tokené•¿åº¦: ${data.data.token.length}å­—ç¬¦\n` +
                        `ç”¨æˆ·: ${data.data.user.username}`, 'success');
                } else {
                    addResult(container, 'âŒ ç™»å½•åŠŸèƒ½å¼‚å¸¸', 
                        `çŠ¶æ€ç : ${response.status}\n` +
                        `å“åº”: ${JSON.stringify(data, null, 2)}`, 'error');
                }
                
            } catch (error) {
                addResult(container, 'âŒ ç™»å½•æµ‹è¯•å¤±è´¥', error.message, 'error');
            }
        }

        async function testManagementAPI() {
            const container = 'management-results';
            document.getElementById(container).innerHTML = '';
            
            try {
                // å…ˆç™»å½•è·å–token
                const loginResponse = await fetch('https://sub-api.senma.io/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'Sz@2400104' })
                });
                
                const loginData = await loginResponse.json();
                if (!loginData.success) {
                    addResult(container, 'âŒ æ— æ³•è·å–è®¤è¯token', 'ç™»å½•å¤±è´¥', 'error');
                    return;
                }
                
                const token = loginData.data.token;
                
                // æµ‹è¯•èŠ‚ç‚¹åˆ—è¡¨API
                const nodesResponse = await fetch('https://sub-api.senma.io/api/nodes', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (nodesResponse.ok) {
                    const nodesData = await nodesResponse.json();
                    addResult(container, 'âœ… èŠ‚ç‚¹ç®¡ç†APIæ­£å¸¸', 
                        `çŠ¶æ€ç : ${nodesResponse.status}\n` +
                        `èŠ‚ç‚¹æ•°é‡: ${nodesData.data ? nodesData.data.length : 0}`, 'success');
                } else {
                    addResult(container, 'âŒ èŠ‚ç‚¹ç®¡ç†APIå¼‚å¸¸', 
                        `çŠ¶æ€ç : ${nodesResponse.status}`, 'error');
                }
                
                // æµ‹è¯•è®¢é˜…åˆ—è¡¨API
                const subsResponse = await fetch('https://sub-api.senma.io/api/subscriptions', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (subsResponse.ok) {
                    const subsData = await subsResponse.json();
                    addResult(container, 'âœ… è®¢é˜…ç®¡ç†APIæ­£å¸¸', 
                        `çŠ¶æ€ç : ${subsResponse.status}\n` +
                        `è®¢é˜…æ•°é‡: ${subsData.data ? subsData.data.length : 0}`, 'success');
                } else {
                    addResult(container, 'âŒ è®¢é˜…ç®¡ç†APIå¼‚å¸¸', 
                        `çŠ¶æ€ç : ${subsResponse.status}`, 'error');
                }
                
            } catch (error) {
                addResult(container, 'âŒ ç®¡ç†APIæµ‹è¯•å¤±è´¥', error.message, 'error');
            }
        }

        async function testAntiCrawler() {
            const container = 'anticrawler-results';
            document.getElementById(container).innerHTML = '';
            
            try {
                // æµ‹è¯•1: æ­£å¸¸ä»£ç†å®¢æˆ·ç«¯è®¿é—®
                addResult(container, 'ğŸ§ª æµ‹è¯•æ­£å¸¸ä»£ç†å®¢æˆ·ç«¯', 'ä½¿ç”¨v2rayN User-Agent...', 'info');
                
                const normalResponse = await fetch('https://sub-api.senma.io/subscriptions/test-uuid/v2ray', {
                    headers: { 'User-Agent': 'v2rayN/6.23' }
                });
                
                addResult(container, 'ğŸ“Š æ­£å¸¸å®¢æˆ·ç«¯ç»“æœ', 
                    `çŠ¶æ€ç : ${normalResponse.status}\n` +
                    `å†…å®¹é•¿åº¦: ${normalResponse.headers.get('content-length') || 'unknown'}`, 
                    normalResponse.status === 404 ? 'info' : 'success');
                
                // æµ‹è¯•2: å¯ç–‘çˆ¬è™«è®¿é—®
                addResult(container, 'ğŸ§ª æµ‹è¯•å¯ç–‘çˆ¬è™«', 'ä½¿ç”¨curl User-Agent...', 'info');
                
                const crawlerResponse = await fetch('https://sub-api.senma.io/subscriptions/test-uuid/v2ray', {
                    headers: { 'User-Agent': 'curl/7.68.0' }
                });
                
                const crawlerContent = await crawlerResponse.text();
                
                if (crawlerResponse.ok && crawlerContent.length === 0) {
                    addResult(container, 'âœ… åçˆ¬æœºåˆ¶æ­£å¸¸', 
                        `çŠ¶æ€ç : ${crawlerResponse.status}\n` +
                        `å†…å®¹: ç©ºï¼ˆå·²æ‹¦æˆªï¼‰\n` +
                        `å†…å®¹é•¿åº¦: ${crawlerContent.length}`, 'success');
                } else {
                    addResult(container, 'âš ï¸ åçˆ¬æœºåˆ¶çŠ¶æ€', 
                        `çŠ¶æ€ç : ${crawlerResponse.status}\n` +
                        `å†…å®¹é•¿åº¦: ${crawlerContent.length}`, 'info');
                }
                
            } catch (error) {
                addResult(container, 'âŒ åçˆ¬æµ‹è¯•å¤±è´¥', error.message, 'error');
            }
        }

        async function testNodeEncryption() {
            const container = 'encryption-results';
            document.getElementById(container).innerHTML = '';
            
            try {
                addResult(container, 'ğŸ”’ èŠ‚ç‚¹åŠ å¯†åŠŸèƒ½', 'æ–°çš„åŠ å¯†æœºåˆ¶ç‰¹æ€§ï¼š\n' +
                    'â€¢ èŠ‚ç‚¹å†…å®¹å¼‚æˆ–åŠ å¯†\n' +
                    'â€¢ Base64 URLå®‰å…¨ç¼–ç \n' +
                    'â€¢ åŠ¨æ€ç­¾åéªŒè¯\n' +
                    'â€¢ 24å°æ—¶é“¾æ¥è¿‡æœŸ\n' +
                    'â€¢ è¯±é¥µèŠ‚ç‚¹æ··æ·†\n' +
                    'â€¢ é…ç½®æ··æ·†å¤„ç†', 'success');
                
                // æµ‹è¯•åŠ å¯†é“¾æ¥ç”Ÿæˆ
                const testData = {
                    uuid: 'test-uuid-12345',
                    format: 'v2ray'
                };
                
                const response = await fetch('https://sub-api.senma.io/secure/generate-link', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Admin Sz@2400104'
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        addResult(container, 'âœ… åŠ å¯†é“¾æ¥ç”Ÿæˆæ­£å¸¸', 
                            `å®‰å…¨é“¾æ¥: ${data.data.secureUrl}\n` +
                            `è¿‡æœŸæ—¶é—´: ${data.data.expiresAt}\n` +
                            `æ ¼å¼: ${data.data.format}`, 'success');
                    } else {
                        addResult(container, 'âš ï¸ åŠ å¯†é“¾æ¥ç”Ÿæˆ', data.error || 'æœªçŸ¥é”™è¯¯', 'info');
                    }
                } else {
                    addResult(container, 'âš ï¸ åŠ å¯†é“¾æ¥æµ‹è¯•', `çŠ¶æ€ç : ${response.status}`, 'info');
                }
                
            } catch (error) {
                addResult(container, 'âŒ åŠ å¯†æµ‹è¯•å¤±è´¥', error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            const info = `
ğŸ¯ æµ‹è¯•ç›®æ ‡ï¼š
1. éªŒè¯ç™»å½•åŠŸèƒ½æ¢å¤æ­£å¸¸
2. ç¡®è®¤ç®¡ç†åŠŸèƒ½ä¸å—å½±å“  
3. éªŒè¯ç²¾å‡†åçˆ¬æœºåˆ¶æœ‰æ•ˆ
4. æµ‹è¯•æ–°çš„èŠ‚ç‚¹åŠ å¯†ä¿æŠ¤

ğŸ”§ ä¿®å¤å†…å®¹ï¼š
â€¢ ç§»é™¤è¿‡åº¦æ¿€è¿›çš„å®‰å…¨ä¸­é—´ä»¶
â€¢ å®ç°è®¢é˜…ä¸“ç”¨çš„åçˆ¬æœºåˆ¶
â€¢ æ·»åŠ èŠ‚ç‚¹å†…å®¹åŠ å¯†ä¿æŠ¤
â€¢ ä¿æŒå¿…è¦çš„DDoSé˜²æŠ¤
            `;
            
            document.body.insertAdjacentHTML('afterbegin', 
                `<div class="result info"><h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3><pre>${info}</pre></div>`);
        };
    </script>
</body>
</html>
